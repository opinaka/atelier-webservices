<!DOCTYPE html>
<html>
<head>
  <title>NGINX vs Traefik vs Kong ‚Äì Live Benchmark</title>
  <meta charset="UTF-8">
  <!-- Lien vers le fichier CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>‚ö° Nginx vs  Traefik vs Apache 2 vs Kong‚ö°</h1>
  
  <div class="warning">
    ‚ö†Ô∏è MODE PARALL√àLE PUR ‚ö†Ô∏è<br>
    Toutes les requ√™tes sont lanc√©es EN M√äME TEMPS !<br>
    Recommand√© : 10-500 requ√™tes max (risque de crash au-del√†)
  </div>
  
  <div class="input-group">
    <label>Nombre de requ√™tes :</label>
    <input type="number" id="numRequests" value="100" min="1" max="100000">
    
    <div class="suggestions">
      Suggestions rapides :
      <button onclick="setRequests(10)">10</button>
      <button onclick="setRequests(50)">50</button>
      <button onclick="setRequests(100)">100</button>
      <button onclick="setRequests(500)">500</button>
      <button onclick="setRequests(1000)">1000 ‚ö†Ô∏è</button>
      <button onclick="setRequests(5000)">5000 ‚ö†Ô∏è</button>
      <button onclick="setRequests(10000)">10000 ‚ö†Ô∏è</button>
    </div>
  </div>  

  <button onclick="benchAll()">‚ö° LANCER TOUS LES TESTS</button>

  <pre id="log">Pr√™t √† lancer les tests...\n\n</pre>

  <script>
    const log = document.getElementById('log');
    const buttons = document.querySelectorAll('button');
    
    function setRequests(num) {
      document.getElementById('numRequests').value = num;
      log.innerHTML += `üìù Nombre de requ√™tes d√©fini √† ${num}\n`;
      log.scrollTop = log.scrollHeight;
    }
    
    function disableButtons(disabled) {
      buttons.forEach(btn => btn.disabled = disabled);
    }

    async function testConnection() {
      log.innerHTML += "\n=== Test de connexion ===\n";
      const services = [
        {name: 'NGINX', port: 8001},
        {name: 'Traefik', port: 8002},
        {name: 'Kong', port: 8003},
        {name: 'Apache 2', port: 8004},
        {name: 'Backend Direct', port: 3000}
      ];
      
      for (const service of services) {
        try {
          const response = await fetch(`http://localhost:${service.port}/`);
          const text = await response.text();
          log.innerHTML += `‚úÖ ${service.name} (${service.port}) : OK (r√©ponse: "${text}")\n`;
        } catch(err) {
          log.innerHTML += `‚ùå ${service.name} (${service.port}) : ERREUR - ${err.message}\n`;
        }
      }
      log.innerHTML += "\n";
      log.scrollTop = log.scrollHeight;
    }

    async function benchAll() {
      const numReq = document.getElementById('numRequests').value;
      const services = [
        {name: 'Backend Direct', port: 3000},
        {name: 'NGINX', port: 8001},
        {name: 'Traefik', port: 8002},
        {name: 'Kong', port: 8003},
         {name: 'Apache 2', port: 8004}
      ];
      
      log.innerHTML += "\n========================================\n";
      log.innerHTML += `üèÅ COMPARAISON COMPL√àTE (${numReq} requ√™tes en parall√®le)\n`;
      log.innerHTML += "========================================\n";
      
      const results = [];
      
      for (const service of services) {
        const result = await bench(service.name, service.port);
        if (result) results.push(result);
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
      
      // Afficher le classement
      log.innerHTML += "\nüèÜ CLASSEMENT FINAL :\n";
      log.innerHTML += "========================================\n";
      results.sort((a, b) => b.reqPerSec - a.reqPerSec);
      results.forEach((r, i) => {
        const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '  ';
        log.innerHTML += `${medal} ${i+1}. ${r.name.padEnd(15)} ‚Üí ${r.time}s (${r.reqPerSec} req/s)\n`;
      });
      
      log.innerHTML += "\n‚úÖ Tous les tests termin√©s !\n\n";
      log.scrollTop = log.scrollHeight;
    }

    async function bench(name, port) {
      disableButtons(true);
      
      const totalRequests = parseInt(document.getElementById('numRequests').value) || 10;
      
      log.innerHTML += `\n=== ${name} (${totalRequests} requ√™tes en PARALL√àLE sur port ${port}) ===\n`;
      log.innerHTML += `‚è≥ Lancement de toutes les requ√™tes en m√™me temps...\n`;
      
      const start = performance.now();
      let errors = 0;
      
      try {
        // TOUTES les requ√™tes en parall√®le d'un coup !
        const promises = [];
        for (let i = 0; i < totalRequests; i++) {
          promises.push(
            fetch(`http://localhost:${port}/`)
              .then(r => {
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                return r.text();
              })
              .catch(err => {
                errors++;
                return null;
              })
          );
        }
        
        await Promise.all(promises);
        
        const time = ((performance.now() - start) / 1000).toFixed(2);
        const reqPerSec = Math.round(totalRequests / parseFloat(time));
        const success = totalRequests - errors;
        
        log.innerHTML += `‚úÖ ${name} ‚Üí ${time}s pour ${success}/${totalRequests} requ√™tes (${reqPerSec} req/s)\n`;
        if (errors > 0) {
          log.innerHTML += `‚ö†Ô∏è  ${errors} erreurs d√©tect√©es\n`;
        }
        
        log.scrollTop = log.scrollHeight;
        disableButtons(false);
        
        return {name, time, reqPerSec, errors, success};
        
      } catch(err) {
        log.innerHTML += `‚ùå Erreur critique: ${err.message}\n\n`;
        log.scrollTop = log.scrollHeight;
        disableButtons(false);
        return null;
      }
    }
  </script>
</body>
</html>